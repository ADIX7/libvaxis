const std = @import("std");
const log = std.log.scoped(.main);
const mem = std.mem;
const process = std.process;

const vaxis = @import("vaxis");
const View = vaxis.View;
const Cell = vaxis.Cell;
const border = vaxis.widgets.border;


const Event = union(enum) {
    key_press: vaxis.Key,
    winsize: vaxis.Winsize,
};

pub fn main() !void {
    var gpa = std.heap.GeneralPurposeAllocator(.{}){};
    defer {
        const deinit_status = gpa.deinit();
        if (deinit_status == .leak) {
            log.err("memory leak", .{});
        }
    }
    const alloc = gpa.allocator();

    var x: usize = 0;
    var y: usize = 0;
    var h: usize = 0;
    var w: usize = 0;
    defer log.info(
        \\Map Size:    {d}x{d}
        \\Screen Size: {d}x{d}
        \\Position:    {d}, {d}
        , .{ 
            map_width, map_height,
            w, h,
            x, y,
        }
    );

    var tty = try vaxis.Tty.init();
    defer tty.deinit();

    var buffered_writer = tty.bufferedWriter();
    const writer = buffered_writer.writer().any();

    // Initialize Vaxis
    var vx = try vaxis.init(alloc, .{
        .kitty_keyboard_flags = .{ .report_events = true },
    });
    defer vx.deinit(alloc, tty.anyWriter());
    var loop: vaxis.Loop(Event) = .{
        .vaxis = &vx,
        .tty = &tty,
    };
    try loop.init();
    try loop.start();
    defer loop.stop();
    try vx.enterAltScreen(writer);
    try buffered_writer.flush();
    try vx.queryTerminal(tty.anyWriter(), 20 * std.time.ns_per_s);
    // Initialize a View
    var map_view = try View.init(alloc, &vx.unicode, .{ .max_width = map_width, .max_height = map_height });
    defer map_view.deinit();
    w = map_view.screen.width;
    h = map_view.screen.height;
    var map_buf: [map_width * map_height]u8 = undefined;
    _ = mem.replace(u8, world_map, "\n", "", map_buf[0..]);
    _ = try map_view.printSegment(.{ .text = map_buf[0..] }, .{ .wrap = .grapheme });

    while (true) {
        const event = loop.nextEvent();
        switch (event) {
            .key_press => |key| {
                if (key.matches('c', .{ .ctrl = true })) break;
                if (key.matches(vaxis.Key.left, .{})) x -|= 1;
                if (key.matches(vaxis.Key.right, .{})) x +|= 1;
                if (key.matches(vaxis.Key.up, .{})) y -|= 1;
                if (key.matches(vaxis.Key.down, .{})) y +|= 1;
            },
            .winsize => |ws| try vx.resize(alloc, tty.anyWriter(), ws),
        }
        x = @min(x, map_width -| 1);
        y = @min(y, map_height -| 1);

        const win = vx.window();
        win.clear();
        try map_view.toWin(
            &win, 
            .{ 
                .x = x, 
                .y = y, 
                //.width = .{ .max = 10 }, 
                //.height = .{ .max = 10 },
            }
        );

        // Render the screen
        try vx.render(writer);
        try buffered_writer.flush();
    }
}

const _world_map = 
\\ +NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN+
\\ W................................................................................................E
\\ W................................................................................................E
\\ W............................ @:::::::::@  .....................    .............................E
\\ W.....      .   .....   :::  ...::::::: ........   ......  %@%...........:*%@    . ..............E
\\ W..@::::::::::::::::::::  :::  ::::@  @@ ..... %#%%%%%%%%%%%%...........................* .......E
\\ W ::::@::::::::::::: .. ::  ... * .......  . %%% %%%%%%%%%%%%%..................... ..* .........E
\\ W  .....@::::::::::::.=::::: ........... @%  @. %%      %%%-...................:%%  @. ..........E
\\ W...... :::%@@:@:::::::::@ :-...........  @%%%%%%%%%%%%%%%%........................ .. ..........E
\\ W......@::::@@@.=-:::::=:  ............. %@%%@# %%%%%%%..%%%.........@............ @=............E
\\ W..... :::::::::::::: ................. %%%    @ % ...........................  . . .............E
\\ W..... #:::::::::::@ .................. @=====@       .........................@  .= ............E
\\ W...... :::::@   @ ................... ============== .... ..................... .. .............E
\\ W....... .::=..  :# ................. ================ ......   ............... .................E
\\ W......... ::::...  @-............... ================- ....@ ...-... . ....@ ..  ...............E
\\ W............. :=.. %  ...............==================+   ......@. .... ... .. @ ..............E
\\ W...............  ######@ ............ ========@=@@@======@........ @.... .  ..  ................E
\\ W................ ######### ................. ===========@............... .@  ..@ =..............E
\\ W............... #############= ............. ========== ................. .  ..*. . ---  .......E
\\ W................ ###@@@#@#####%.............. ======== .................... @.@.... .*-=- ......E
\\ W................. ##@##@@#@### .............. ========-. -......................   -- + ........E
\\ W................... ##########................=======% *= .................... @-------- .......E
\\ W................... #######*  ................-====== .-+....................#-@--@-@#--- ......E
\\ W................... ####### .................. ====- ........................@----------- ......E
\\ W................... ###### ....................@-* .......................... =    ----:.....  .E
\\ W....................####@ ......................................................... -  ....  -@ E
\\ W.................... ###.................................................................%-@ ...E
\\ W..................... #@........................................................................E
\\ W......................    ......................................................................E
\\ +SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS+
\\
;

const world_map = 
\\  +NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN+ 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W........................................................................................................................................................       ............................................................................................................................................................................................................................................E 
\\  W................................................................................................................................                                           ................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................            @@@@@@@@%-::::---::::::=#@@@@....   ................................................................................................................................................................................................................................E 
\\  W.....................................................................................................................       .@@@@:::::::::::::::::::::::::::::::::::::-@@   ...............................................................................................................................................................................................................................E 
\\  W....................................................................................................................   %@@@#:::::::::::::::::::::::::::::::::::::@@-       ......................................................................................                 .........................................................................................................................E 
\\  W...................................................................................................................   @:::::::::::::::::::::::::::::::::::::::::@     ....................................................................................         .@....@@:        .......................................................................................................................E 
\\  W...............................................................................................                ....           +:::::::::::::::::::::::::::::::::-  ...........................................................................    ..         #@-.................@                   ......................................................................................................E 
\\  W.........................................................................................         +@@@@@@@@@@    ....         @:::::::::::::::::::::::::::::::@:   ........................................................................            @@...........................%%%%*....%%@@=                       ..................................................................................E 
\\  W........................                        ...               ....................          @:::::::::::::@     ........  @::::::::::::::::::::::::::::+%    ...............................               .......................       @%%%%@@@%%%............................................-@@   %@@*******@@                ..       ............................................................E 
\\  W...................       *@@#+++++++++@@%===          ========                 ...     @@::@  +::::::::::::::::-@   .......   *:::::::::::::::::::::::::::%@   .............................        %@@@@@=                ..            :@%%%%%%%%%%#.........................................................................+@=                        ................................................E 
\\  W................    :@%=:::::::::::::::::::::::%%%-.:::::::::::::+%@@                   =:::::--:::::@##%%::::::::@   .....    @:::::::::::::::::::::::%@+      ............................   @@%#%%%%%%%%%%#@@*                +***@@%%%%%%%%%%%%%##..........................................................................................-%@@@@@+          .........................................E 
\\  W.............      .*::::::::::::::::::::::::::::::::::::::::::::::::::::::::::%@@@=:::::::::::::::@@     @::::::::@   ....  @:::::::::::::::::::@@.                ......................    @%%%%%%%%%%%%%%%#%%%%%%%@@%%%%@@@%%%%%%%%%#%%%%%%%%%%%%=.....................................................................................................@@@%.       ....................................E 
\\  W............  =#-:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::=@*     @+:::::=:::+@  ...   @::::::::::::::::@.        @@@@@%%@@@   ...................    @@%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%%%%%%%%%%%%%............................................................................................................@@@   ...................................E 
\\  W.........      *::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::@  *%::::::::::@ @@    ...  *::::::::::@@@        ...    %%%%%%%%@   ................     @@%%%%%##%* -%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%......................................................................................................*   @...@  ...................................E 
\\  W.......    =@@=::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::@ =@@@@          @:::::=@     .....  *:::::::::@        .......   :=@%%@     .............      %@%%%%%%%%%@: @%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#=.......................................................................................................@        ...................................E 
\\  W......   @:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::@:            @:::-@    @@*    ........   @::::::@-   ..............           ...............  @@@%%%%%%%%%%@   @%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.....................................................................................................+@@    .......................................E 
\\  W.....  :@::::::::::::::::#%*::::::::::::::::::::::::::::::::::::::::::::::::::::@      ......   @:::::::@        ..........   ..@:@:    ..............................       ....  *@%%%%%%%%%%%@*  +@%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%....................................................................................@ .@.=@.........@     .........................................E 
\\  W....    @::::::::::=%@@         #%:::::::::::::::::::::::::::::::::::::::::::::-    ........   @::::::::@:@=::@   ...........        ................................   -@@    ..   @%%%@@%%%%%%%=#   @%%%%%%%%%%%%%%%%%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.........................................................................%@@@@@####@#     +....#%      ............................................E 
\\  W.      -@-:::*@-           ..     @::::::::::::::::::::::::::::::::::::::::::::@+     .....   @:::::::::::::::.-  ...................................................  @%%%@%  ...         @%%%@#    #@%%%   : : -   %=  ::   :  +%%%%%%%%%%%%%%%%%%%%%%.......................................................................-.                @.....@    ...............................................E 
\\  W   @:::::%@        .............  ::::::::::::::::::::::::::::::::::::::::::::::::%+        +@:::::::::::::::::@   ...............................................     %@%%%=   ...    %@  @%%%@    @%%%%%  %. . -        : . . +%%%%%%%%%%%%%%%#*%##%-.......................................................................:*         .....   @......@:   ..............................................E 
\\  W@::::+@       ..................  ::::::::::::::::::::::::::::::::::::::::::::::::::.+@   @*::::::::::::::::::::@    ...........................................    :@@  @%%@#   .    #%%-       @@@%%%%%%   . . -   #    :   .  *#%%%%%%%%%%%#...............................................................................-@%%         ....   @........  ..............................................E 
\\  W          ......................  :::::::::::::::::::::::::::::::::::::::::::::::::::-.  @::::::::::::::::::::::::*  ...........................................   @%%%@  @%%%@     @@@%%%%%%%%%%%%%%%%%%%  @. . -        : *#. *%%%%%%%%%%%%%#.........................................................................................@   ....    @.....%  ..............................................E 
\\  W..     .........................  ::::::::::@:@:@@@:%@@%%@@@@@=@:::::::::::::::::::::=  #=:::::::::::::::::::::::@   ...........................................  :@%%%@ #%%%%%@  @@%%%%%%%%%%%%%%%%%%%%%%   %   % . .*  += *%:  -%%%%%%%%%#%............................................................................................@     ...    +@..#  ..............................................E 
\\  W...............................  .@.::::::::@#@.@+@@%@*@:%@:@@#@:::::::::::::::::::::::::::::::::::::::::::::::::@   ...........................................   @@@  @@%@@@@ @@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%...............................................................................................@-   ....     @   ..............................................E 
\\  W...............................  @::::::::::@@@:@+@%%@%@:%@:@@@@:::::::::::::::::::::::::::::::::::::::%@@  @:::::@   ...........................................          @@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.................................................................................................@    .....     ...............................................E 
\\  W...............................   @:::::::::@=@:@*@#%@+@:%@:@@=@::::::::::::::::::::::::::::::::::::::*@   @::::::*   ................................................  .@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##%##%%%%%%%%%%%%%.............................................................................................@@=.-:  .........................................................E 
\\  W...............................   @:::::::::::::::::::::::::::.::::::::::::::::::::::::::::::::::::::.     @@@:@-:+=  ................................................    @%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%#.......*%##%%%%%%%#%...........................................................................................-   @.@  .........................................................E 
\\  W..............................   @::::::::.:@@::@@:@@+@@.@@@:@*:@@*:@@*:::::::::::::::::::::::::::::::::@             .............................................  .     @%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%%#............%%%%%%%%%%..............................@@.+@-@.@.@@@................................................@            .....................................................E 
\\  W............................   -=:::::::::::@@*:@@*@@+@::@:@:@*@@=@:@@@::::::::::::::::::::::::::::::@@@    .....................................................          @%%%%%%%%%#%%%%%%@-@@%%%#%%%%%%%%%%%%%%%%%%%%##%#.........%#%%%%%%%%%=...........................@@=.@@..@.@.@...............................................@      *@@     ....................................................E 
\\  W...........................   @:::::::::::::@=@:@@@%@+@@.@@@:@*@@:::@.@:::::::::::::::::::::@@#  :%@      ......................................................   @%%%%%%%%%%%%%@@@@@- *@%#@- .@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%........#%%%%%%%%%%..........................*@@@.:*@.@.@+@..............................................@      =....#   ....................................................E 
\\  W..........................   @:::::::::::::+@@@:@=@%@+@::@.@:@*#@=@:@@@:::::::::::::::::::.@           ........................................................   @%%%%%%%%%%%%%%@        #@%%@@  .@%%%%%%%%%%%%%%%#%%%%%%%%%%..........%%%%%%%#%=.........................@@=@.@@@.@.@.@............................................@    .   =..++   .....................................................E 
\\  W.........................   @::::::::::::::-=:=:=:--=:==:=:=:=::*@::=:=::::::::::::::::@#     .................................................................   @%%%%%%%%%%%@@-   ....    .@@%%@* @%%%%@@@***%%%#......................%%%%%%%%%..................................................................................%   ...           .....................................................E 
\\  W.........................  @.:::::::::::::::::::::::::::::::::::::::::::::::::::::::-%      ...................................................................  @%%%%%%%%%%%@     .......     @%@  @%%#@  -...............................#%%%%#.........................................................................% #*@@....+   .....    ..@  .....................................................E 
\\  W.........................   @::::::::::::::::::::::::::::::::::::::::::::::::::::::@    .......................................................................   @%%%%%%%%%@:              @%%%%@   :%%%  .@.............................................................................................................@     @....@    ...   ...@  .....................................................E 
\\  W..........................  @:::::::::::::::::::::::::::::::::::::::::::::::::::::-   ..........................................................................   ==-@@@@@  .@@+--*#####@#   @%@     @@@     @................................................................................................................=   @...        +...@  .....................................................E 
\\  W..........................  @::::::::::::::::::::::::::::::::::::::::::::::::::::.@   ...........................................................................    %@@@@@@=-============@        .                @+.=.....................................................................................................@      #..@    @@%....@  .....................................................E 
\\  W..........................  =@::::::::::::::::::::::::::::::::::::::::::::::::::@    ...........................................................................    @=====================@       ..       ......      @......................................................................................................@      +-   @.....@     .....................................................E 
\\  W...........................   *::::::::::::::::::::::::::::::::::::::::::::::@=    ............................................................................   @-======================-@+..       ...              @.......................................................................................................@        .@...%*+    .......................................................E 
\\  W............................   *:::::::::::::::::::::::::::::::::::::::::::@     .............................................................................  :*-============================-@:.  +====-@@@@@@@@*  %.........................................................................................................@   ..  @..-@ @@  .........................................................E 
\\  W............................   @:::@@::::::::::::::::::::::::::::-*=:::::=.   ...............................................................................   @==================================--===============-@#..........................................................................................................-  ..   *@  @.@  .........................................................E 
\\  W.............................   @:@ @:::::::::::::::::::.@......     #@:::   .............................................................................    ##=====================================================@ *................- #.....................................................................................=   ...  :..      .........................................................E 
\\  W..............................  @:@ @::::::::::::::::@                :-::   ............................................................................   @@-======================================================%  -...............@   @..................................................................................+.   ...        ............................................................E 
\\  W..............................  @::@ %::::::::::::::+    ...........   @.:   ..........................................................................    @=========================================================-@ %.................@#  @.:@@:...........................................................................@   ......    ..............................................................E 
\\  W..............................   @:.- *-:::::::::::.@   ............    .@   .........................................................................   @============================================================-= *+.................@    .  ==@@......................................................................:.  .........................................................................E 
\\  W...............................  =@:+% @::::::::::.@   ...........           ........................................................................   @-============================================================-@.  @................:%%:..:@           :+-...........................................................%    .........................................................................E 
\\  W................................    =.@ -@::::::::.%  .....        -@::::*@@     ....................................................................  #-===============================================================:@  @:........................+   ..      %........................................................@%   ...........................................................................E 
\\  W.................................        =::::::::.@   ...    #@   @:  -@:::@@:        .............................................................   @=================================================================%   @........................@   ......   @ .....................-@@-@.........................**     ............................................................................E 
\\  W.......................................  @:::::::::.@       #::%           *:::=:        ...........................................................  *-=================================================================-   @.......................@   ........     ...................@     @..................@ -@@    .......     ....................................................................E 
\\  W.......................................  +@.:::::::::%@@@@@@:::@   .....         @::::@   ..........................................................   @-=================================================================@.   @....................@   ............  :@...............@    .   :-...............-       ........        ..................................................................E 
\\  W........................................    -@::::::::::::::::@    .......      .-+@@-:   ...........................................................   :==================================================================-@   @.................@    .............  @..............@    ....   *................+@   .........   @..@  ..................................................................E 
\\  W..........................................     @@**+:.::::::::@       .........          ...........................................................   @====================================================================-+   @.............@+    ...............   :*..........*@   .......   +.................@   ........  +:..-   .................................................................E 
\\  W.............................................          *%::::::::::@   .............................................................................  +-=====================================================================*@   #........-#@     ..................   #........**    ........       @..............-   .......  @:..@#   ................................................................E 
\\  W....................................................     -@::::::::%   .........      ..............................................................  +-========================================================================%  @...:@@      ......................   @.......@   .............     =.............+   .......    @@..#   ...............................................................E 
\\  W........................................................     @+::::@  ......     :+:         .......................................................   @-========================================================================-@ =%-         .......................   @......*   ...............    ..............@  .........    *@@   ...............................................................E 
\\  W..........................................................     @:::@   ...    @@%####@.           ...................................................   %+===================================@@=-@@=@@@-@@-@@@-@@@=================.  .#@+-=@   ........................   @.....:   ................   ..=  @.......-=  ...........       ................................................................E 
\\  W.............................................................   -::+@       ###################@   ...................................................    #-================================-@%%-@--@=@+@@=@-@-@+@-=========================@  ..........................   @...@-   ................   ..@    @...@@    ..................................................................................E 
\\  W.............................................................    -@@:+@@@#######################@    ...................................................   *-================================@=@-@=-@=@+@@=@-=-@:@=========================@   ...........................   @.%     ................   ...@    @@:    ........    ........................................................................E 
\\  W...............................................................         @%########################@       ...............................................   --==============================*@*@-@--@=@+@@-@-@-@+@========================-*  .............................       @+   .............    @...@       .........   :    ......................................................................E 
\\  W...................................................................      =###########################@@*    ..............................................   @-================---========================================================@   ...............................    *.-   ...........       %%...@   .........    #.@     ....................................................................E 
\\  W.......................................................................  .##############################+@    .............................................    @%=---=-*+--%@     @-====================================================-@   ..................................        ...........   @.@   @...@  .......    @#....-:  ....................................................................E 
\\  W......................................................................   @################################=@  ...............................................                          @-==============================================-@   ....................................     ..............   @..@  @..@   ...     =@.....@    ..    ..............................................................E 
\\  W.....................................................................   @##################################@   ...................................................................      +============================================--*   .........................................................   *...@  @.@        @........@           .............................................................E 
\\  W....................................................................   @####################################@      ..................................................................   *===========================================%#    ............................................................   @..#@@       @............@ .++#@.@  ....     ....................................................E 
\\  W...................................................................   @######################################@+         .............................................................  @==========================================-@    ...............................................................   +....@      @..........@# *.....%   ..               ............................................E 
\\  W...................................................................  @#############################################%@+      .........................................................  @-========================================-@   ..................................................................   @-...@-    @.........+:  @...*@   ..   @---+:            .......................................E 
\\  W...................................................................  @##################################################@@     ......................................................   =-=====================================-@    ....................................................................    @....%    @........@  @....#   ....   #+--+##---=@%      .....................................E 
\\  W...................................................................   %##############%@@@#@@@#@%@%@@@#@%@@#################@.    .....................................................   @-===================================-@   ........................................................................   %@..@       @@@@#@   .....+   .....   @+=-----------+@     ..................................E 
\\  W...................................................................  @###############@@###@#@#@%@%#@%#@@@@####################@=   ....................................................   @-==================================@   ..........................................................................    @..@               .:@@@@   ......      @------------#@   .................................E 
\\  W...................................................................  +%################@@#@#@#@%@%#@%#@@@@#####################*   .....................................................   :-=================================@  .............................................................................   *...:@@@@#                ...........     #-----------@   ................................E 
\\  W....................................................................   @#############%@%@#@#@#@%@##@%#@%@@#####################@   ......................................................   @=================================@  ..............................................................................     @........@#   ......................   @------------@   ...............................E 
\\  W.....................................................................   #######################################################.  .......................................................   @=================================@    ..............................................................................        @@%.++@  ...............     ..   :+:@---@  @--*%   ..............................E 
\\  W.....................................................................    @############@@#%@%%@%@@@#@@@#@#%@@%#@@##############%   ........................................................  .*===================================  ..................................................................................             ..............                      @%%@@   .............................E 
\\  W.......................................................................   @###########@@#%@@@@%@@##@#@#@#@%@@#@@@#############*   ........................................................   %=================================-#  ....       .................................................................................................   %=@@@@=  .   :@             .............................E 
\\  W........................................................................   @#########%@@@%@@@@%@@@%@@@#@#@%###@%@###########@    ........................................................   @-=================================%   ...   :*@   ........................................................................................          @------+  .  -=-@   ....   ...............................E 
\\  W.........................................................................   @########@@@@%@@@@%@@#%@#@#@#@%@@%@@@###########   .........................................................   @===================================%        @-=+   .......................................................................................   #@@@@%@--------:     @--+    .....................................E 
\\  W..........................................................................   @############################%#################+  .........................................................   ===================================-@     =@@===+   ....................................................................................     %=--------------=    .=---=+   ....................................E 
\\  W...........................................................................     @@#########################################**  .........................................................   ==================================-@    @-======@   ...................................................................................   %+------------------*@= @-----#   ....................................E 
\\  W..............................................................................     @#######################################@   .........................................................   +===============================-@      =======%   .................................................................................     .@-----------------------------#   ....................................E 
\\  W.................................................................................  =#######################################@   .........................................................   -+============================-@    .   @=====+   ................................................................................    :@--------------------------------%*    ..................................E 
\\  W.................................................................................   @#####################################@   ...........................................................   --==========================@    ..    @====-@   ..............................................................................    @--------------------------------------@   .................................E 
\\  W..................................................................................  @#####################################@  .............................................................   %==========================@   ...  @-=====@   .............................................................................    @-----------------------------------------%   ................................E 
\\  W..................................................................................  @*#################################%@    ..............................................................   %=========================@   ...  +-====*   .............................................................................   @-----+@@-@*@@-@@@*@@@*@@#-@@=-@--@-*@@-----=@   ...............................E 
\\  W..................................................................................  :*############################+@*      ................................................................   %========================-@   ...   @-==-@  ..............................................................................   *-----@+@-@*@@+@---#@-*@*@-@*#-@--@-@+@-------*   ..............................E 
\\  W..................................................................................  :*###########################@     .....................................................................  @-=======================*   .....   @@-@   ..............................................................................   *-----@-@-@*@@--@@-#@-*@%@-@=@-@--@-@-@-------@   ..............................E 
\\  W..................................................................................  :*###########################   ........................................................................  =+=====================@    .......        ...............................................................................   @-----@#@+@#@@+@-@-#@-*@+@*@%@-@--@-@#@+------@   ..............................E 
\\  W..................................................................................  :############################@  ........................................................................    #===================*.  ................................................................................................   @---------------------------------------------=  ...............................E 
\\  W..................................................................................   %##########################@   .........................................................................    +================-@    ................................................................................................   =--------------------------------------------#   ...............................E 
\\  W..................................................................................   @#########################@   ...........................................................................   @================@   ..................................................................................................   @-------------------------------------------@   ................................E 
\\  W...................................................................................  @#######################%*   .............................................................................   @-===========-@:   ....................................................................................................   *----------------------------------------+@   .................................E 
\\  W...................................................................................  @#######################*   ...............................................................................  *:=========-@*   ......................................................................................................   *----%            @--------------------@    ..................       ..........E 
\\  W...................................................................................  @#####################%=   ................................................................................  .@-=-#%%%%@    ........................................................................................................  :*...               @------------------@    ..................   @@   ..........E 
\\  W...................................................................................  @####################@    .................................................................................               ...........................................................................................................        ...........    @--------------@    ....................  @--@   .........E 
\\  W...................................................................................   %####################   .....................................................................................     ......................................................................................................................................    @-----------=.   .....................   @---@:   .......E 
\\  W...................................................................................   @##################%   ...................................................................................................................................................................................................................................  .%=---------@   ....................    @#-----@  .......E 
\\  W....................................................................................   @##############%@-    ....................................................................................................................................................................................................................................      @@@       ..................     ==----=@    .......E 
\\  W....................................................................................   @#############@     .........................................................................................................................................................................................................................................         ...................     @+----@      .........E 
\\  W.....................................................................................   @############   ....................................................................................................................................................................................................................................................................      %@----*@:   .............E 
\\  W......................................................................................   %##########=   .................................................................................................................................................................................................................................................................       @-----@     ...............E 
\\  W......................................................................................   @#########@   .................................................................................................................................................................................................................................................................   =@-----#@#    ..................E 
\\  W.......................................................................................   %#######@   .................................................................................................................................................................................................................................................................   %--+@#%      ....................E 
\\  W.......................................................................................   @#######@@.  .................................................................................................................................................................................................................................................................           ........................E 
\\  W........................................................................................   @########@  ..................................................................................................................................................................................................................................................................     .............................E 
\\  W.........................................................................................   @#####%.   ....................................................................................................................................................................................................................................................................................................E 
\\  W..........................................................................................   @#####+   ....................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................   @#####@     .................................................................................................................................................................................................................................................................................................E 
\\  W............................................................................................   +@@@##%@#    ...............................................................................................................................................................................................................................................................................................E 
\\  W.............................................................................................      +@@@@@   ...............................................................................................................................................................................................................................................................................................E 
\\  W.................................................................................................          ................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  W...........................................................................................................................................................................................................................................................................................................................................................................................................E 
\\  +SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS+ 
\\
;
const map_width = mapWidth: {
    @setEvalBranchQuota(100_000);
    break :mapWidth mem.indexOfScalar(u8, world_map, '\n').?;
};
const map_height = mapHeight: {
    @setEvalBranchQuota(100_000);
    break :mapHeight mem.count(u8, world_map, "\n");
};
